<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Logs</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
        body {
            background-color: #121212;
            color: #FFFFFF;
        }

        .table-dark {
            color: #FFFFFF;
            background-color: #242424;
        }

        .table-dark th, .table-dark td, .table-dark thead th {
            border-color: #404040;
        }

        .btn-dark {
            border-color: #404040;
        }
    </style>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="/">Dashboard</a>
    <div class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" href="/chat">Chat Logs</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/reports">Reports</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/bans">Blocks</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/servers">Servers</a>
            </li>
        </ul>
    </div>
</nav>
<div class="container mt-5">
    <div class="row mb-3">
        <div class="col-md-4">
            <input type="text" id="player_id" class="form-control bg-dark text-white" placeholder="Enter Player ID">
        </div>
        <div class="col-md-2">
            <button id="filter" class="btn btn-dark">Filter</button>
        </div>
    </div>
    <table class="table table-dark">
        <thead>
        <tr>
            <th>Player Name</th>
            <th>Message</th>
            <th>Timestamp</th>
        </tr>
        </thead>
        <tbody id="chatLogs"></tbody>
    </table>
    <div class="row">
        <div class="col-md-6">
            <button id="prev" class="btn btn-dark">Previous</button>
        </div>
        <div class="col-md-6 text-right">
            <button id="next" class="btn btn-dark">Next</button>
        </div>
    </div>
</div>

<!-- jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
        let server_id = 1;
        let next_from = null;
        let prev_from = null;

        function fetchData() {
            const player_id = $("#player_id").val();
            let url = `/api/chat?server_id=${server_id}`;

            if (player_id) url += `&player_id=${player_id}`;
            if (next_from) url += `&next_from=${next_from}`;
            if (prev_from) url += `&prev_from=${prev_from}`;

            $.get(url, function (data) {
                $("#chatLogs").empty();
                data.logs.forEach(log => {
                    let row = $("<tr>").attr("data-steamid", log.steamid_64);
                    let tdUsername = $("<td>");
                    let tdMessage = $("<td>").text(log.message);
                    let tdTimestamp = $("<td>").text(log.timestamp);

                    let a = $("<a>")
                        .attr("href", "http://steamcommunity.com/profiles/" + log.steamid_64)
                        .attr("target", "_blank")
                        .text(log.username);

                    tdUsername.append(a);
                    row.append(tdUsername, tdMessage, tdTimestamp);

                    row.click(function() {
                        const steamID = $(this).data('steamid');

                        // Remove highlight from all rows
                        $("#chatLogs tr").css('background-color', '');  // Clear the inline style

                        // Add highlight to rows with the same steamID
                        $(`#chatLogs tr[data-steamid="${steamID}"]`).css('background-color', '#3e0404');
                    });

                    $("#chatLogs").append(row);
                });



                next_from = data.next_page_id;
                prev_from = data.prev_page_id;

                // Check next_page_id and prev_page_id and enable/disable buttons accordingly
                if (next_from === -1) {
                    $("#next").prop("disabled", true);
                } else {
                    $("#next").prop("disabled", false);
                }

                if (prev_from === -1) {
                    $("#prev").prop("disabled", true);
                } else {
                    $("#prev").prop("disabled", false);
                }
            });
        }

        $("#filter").click(function () {
            next_from = null;
            prev_from = null;
            fetchData();
        });

        $("#next").click(function () {
            prev_from = null;
            fetchData();
        });

        $("#prev").click(function () {
            next_from = null;
            fetchData();
        });

        // Initial data fetch
        fetchData();
    });
</script>
</body>
</html>